<!DOCTYPE html><html lang="en"> <head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png"><link rel="manifest" href="/blog/site.webmanifest"><title></title><meta name="description"><link rel="stylesheet" href="/blog/_astro/about.CleY2ZeH.css"></head> <body class="prose prose-stone mx-auto max-w-[700px] min-h-screen flex flex-col"> <div class="border-b border-tapa-100 mb-8"> <div class="flex text-center justify-between items-center my-10 text-lg w-full"> <div> <a href="/blog/" class="no-underline hover:text-smalt">Irina's Notes</a> </div> <div class="flex flex-row gap-4"> <a href="/blog/posts/" class="hover:text-smalt no-underline"> Posts </a><a href="/blog/topics/" class="hover:text-smalt no-underline"> Topics </a><a href="/blog/about/" class="hover:text-smalt no-underline"> About </a> </div> </div> </div>  <article class="flex flex-col max-w-full flex-grow"> <header> <h1>Handling unexpected queries in database migrations</h1> <p>13 May 2024</p> </header> <main> <p>When generating migrations with new changes, you may find that the new migration file contains additional queries that you didn’t write. This can be confusing and might initially seem like an error.</p>
<p>This scenario typically occurs due to a mismatch between the state of your backend (BE) and your database (DB). Here are two common situations:</p>
<ol>
<li><strong>Current BE, outdated DB</strong>: you’ve updated your backend code but your local database isn’t synchronised with these changes.</li>
<li><strong>Current DB, outdated BE</strong>: your database is up to date, but your backend code is several commits behind.</li>
</ol>
<p>These mean that your local environment isn’t aligned with the latest state of the app, leading TypeORM (or any ORM you might be using) to auto-generate queries to bridge the gap to the last known state.</p>
<p>In my experience, this usually happened to me because I had fetched the latest database state but hadn’t updated my backend code accordingly. I was trying to add a new migration without the latest backend updates, prompting TypeORM to insert additional queries to reach the latest state of the app.</p>
<p><strong>Here’s what to do if this happens to you:</strong></p>
<ul>
<li><strong>Check the migration file</strong>: always review the contents of a new migration file to be sure it only includes your changes.</li>
<li><strong>Identify outdated components</strong>: if you notice unexpected queries, verify whether your backend or database is outdated and update it.</li>
<li><strong>Regenerate the migration</strong>: once everything is updated, try generating the migration again. If no unexpected changes appear and no new migrations are created when everything is up-to-date, then you’re set to go.</li>
</ul>
<p>Remember the importance of keeping both your database and backend in sync with the latest changes, especially before attempting to introduce new migrations.</p> </main> <div class="flex flex-wrap flex-col mb-12"> <h2 class="mb-4">Topics:</h2> <div class="flex gap-2"> <a href="/blog/topics/backend">backend</a><a href="/blog/topics/database">database</a><a href="/blog/topics/migration">migration</a><a href="/blog/topics/typeorm">typeorm</a> </div> </div> </article>  <div class="flex justify-center w-full mb-4">
Made with ♥︎ by Irina Korotkaya
</div> </body></html>